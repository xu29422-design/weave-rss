# RSS 简报自动导入 - 使用说明

**账号**: 1159370261@qq.com  
**API Key**: wps_1770173096274_b4pz5s  
**创建时间**: 2026-02-04

---

## 📋 使用步骤（5步完成）

### 第1步：准备多维表格

在 WPS 中创建多维表格，包含以下字段（名称必须完全一致）：

| 字段名 | 类型 |
|--------|------|
| 标题 | 单行文本 |
| 内容 | 多行文本 |
| 摘要 | 多行文本 |
| 来源 | 网址 |
| 分类 | 单行文本 |
| 质量分数 | 数字 |
| 发布时间 | 日期时间 |
| 导入时间 | 日期时间 |

---

## 📌 原始 RSS 数据表（可选）

如果你要在第二张多维表中查看“原始 RSS 抓取数据”，请新建一张表并包含以下字段：

| 字段名 | 类型 |
|--------|------|
| 标题 | 单行文本 |
| 内容 | 多行文本 |
| 来源 | 网址 |
| 来源名称 | 单行文本 |
| 发布时间 | 日期时间 |
| 抓取时间 | 日期时间 |

对应脚本文件：`RSS原始数据导入.js`

### 第2步：添加网络API服务（重要！）

在 WPS 多维表格中：
1. 点击顶部菜单栏的 **【脚本】**
2. 点击 **【JS脚本】** → **【新建脚本】**
3. 点击顶部的 **【工具栏】**
4. 选择 **【服务】**
5. 添加 **"网络API"** 服务

⚠️ **如果不添加这个服务，脚本将无法运行！**

### 第3步：复制脚本代码

1. 打开文件：`RSS简报自动导入.js`
2. 全选复制（Ctrl+A → Ctrl+C）

### 第4步：修改配置

在脚本中找到以下配置（第8-11行）：

```javascript
var API_URL = 'https://www.weaverss.online';  // 外网地址
var USER_ID = '1159370261@qq.com';      // 您的用户ID
var API_KEY = 'wps_1770173096274_b4pz5s';  // 您的API密钥
var TABLE_NAME = 'Sheet1';  // ⚠️ 改为您的表格名称
```

**重要**：修改 `TABLE_NAME` 为您实际的表格名称！

### 第5步：运行脚本

1. 点击 **【保存】** 按钮
2. 点击 **【运行】** 按钮
3. 查看底部的 **【运行日志】** 窗口

---

## 📊 运行结果示例

### 成功运行

```
========================================
RSS 简报自动导入
时间: 2026-02-04 14:30:00
========================================

[1/5] 连接表格...
OK - 表格: Sheet1

[2/5] 请求API...
请求: http://localhost:3000/api/digest/latest?...
OK - 获取到 10 条数据

[3/5] 检查数据...
OK - 数据有效

[4/5] 开始导入...
表格现有 0 条记录

+ 成功: 文章标题1
+ 成功: 文章标题2
+ 成功: 文章标题3
...

[5/5] 导入完成
========================================
成功: 10 条
跳过: 0 条 (重复)
失败: 0 条
总计: 10 条
========================================
```

### 跳过重复数据

```
[4/5] 开始导入...
表格现有 5 条记录

+ 成功: 新文章1
- 跳过: 旧文章1
- 跳过: 旧文章2
+ 成功: 新文章2

[5/5] 导入完成
========================================
成功: 2 条
跳过: 2 条 (重复)
失败: 0 条
总计: 4 条
========================================
```

---

## ⚠️ 常见问题

### 问题1：`HTTP is not defined`

**原因**：没有添加"网络API"服务

**解决**：
1. 点击 【工具栏】→ 【服务】
2. 添加 "网络API"

### 问题2：`未找到表格 "Sheet1"`

**原因**：表格名称不正确

**解决**：
修改脚本第11行：
```javascript
var TABLE_NAME = '您的实际表格名称';
```

### 问题3：`HTTP 500` 或网络请求失败

**原因**：本地服务未启动

**解决**：
在项目目录运行：
```bash
npm run dev
```

### 问题4：`暂无新数据`

**原因**：
1. 还没有订阅 RSS 源
2. 今天还没有生成简报
3. 数据已经导入过了

**解决**：
先在网页端配置 RSS 订阅并等待简报生成

### 问题5：字段添加失败

**原因**：表格字段名称不匹配或类型错误

**解决**：
确保表格有以下字段（名称和类型完全一致）：
- 标题（单行文本）
- 内容（多行文本）
- 摘要（多行文本）
- 来源（网址）
- 分类（单行文本）
- 质量分数（数字）
- 发布时间（日期时间）
- 导入时间（日期时间）

---

## ⏰ 设置定时任务

脚本测试成功后，可以设置定时任务自动导入：

1. 在脚本编辑器中，点击 **【定时任务】**
2. 点击 **【新建定时任务】**
3. 配置：
   - **任务名称**：RSS简报自动导入
   - **执行函数**：`main`
   - **执行频率**：每天上午 9:00（或您喜欢的时间）
   - **启用任务**：✅ 勾选
4. 点击 **【确定】**

---

## 🔄 更新API地址（部署后）

已部署到线上并绑定自定义域名后，请使用以下 API 地址：

```javascript
var API_URL = 'https://www.weaverss.online';
```

---

## 📞 技术支持

### API 地址

**线上**：`https://www.weaverss.online/api/digest/latest`

### 请求参数

- `userId`: 1159370261@qq.com
- `apiKey`: wps_1770173096274_b4pz5s
- `days`: 1（获取最近几天的数据）

### 测试 API

在浏览器中访问：
```
https://www.weaverss.online/api/digest/latest?userId=1159370261@qq.com&apiKey=wps_1770173096274_b4pz5s&days=1
```

应该返回：
```json
{
  "success": true,
  "data": {
    "totalItems": 10,
    "items": [...]
  }
}
```

---

## ✅ 检查清单

导入前请确认：

- [ ] 已创建多维表格，包含所有必需字段
- [ ] 已添加"网络API"服务
- [ ] 已复制脚本代码到 WPS
- [ ] 已修改 `TABLE_NAME` 为实际表格名称
- [ ] 本地服务正在运行（`npm run dev`）
- [ ] 已在网页端配置 RSS 订阅

全部完成后，点击"运行"按钮！

---

**祝使用愉快！** 🎉
